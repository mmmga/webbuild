<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Webbuild by sascha-andres</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Webbuild</h1>
      <h2 class="project-tagline">Run frontend builds inside a docker container</h2>
      <a href="https://github.com/sascha-andres/webbuild" class="btn">View on GitHub</a>
      <a href="https://github.com/sascha-andres/webbuild/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/sascha-andres/webbuild/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="webbuild" class="anchor" href="#webbuild" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>webbuild</h1>

<p>webbuild is a docker container that runs your frontend build tasks. It
was designed to have them running in a clean predefined environment yet
being customizable</p>

<p>The container can be used using briefbote/webbuild</p>

<h2>
<a id="inside" class="anchor" href="#inside" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Inside</h2>

<p>There are three flavors of this container:</p>

<ul>
<li>PHP 5.5</li>
<li>PHP 5.6</li>
<li>PHP 7.0</li>
</ul>

<p>You can use specific php versions by using them as a tag:</p>

<p><code>docker run briefbote/webbuild:55</code> for PHP5.5 for example.</p>

<p>The <code>latest</code> tag points to the PHP7.0 version</p>

<p>Build expects <code>/src</code> containing the source code and <code>/app</code> containing the release after all build steps have run.</p>

<p>Git is installed within the container.</p>

<p>The package build-essential is installed within the container.</p>

<h3>
<a id="ruby" class="anchor" href="#ruby" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>RUBY</h3>

<p>RUBY builds are now deprecated. Plase inherit from the image and install Ruby in a prebuild.sh.</p>

<h2>
<a id="execution" class="anchor" href="#execution" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Execution</h2>

<p>NODEJS will be installed using nvm. It is respecting .nvmrc. After that, grunt, gulp and bower are installed</p>

<h3>
<a id="customization" class="anchor" href="#customization" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Customization</h3>

<h4>
<a id="not-required-build-tools" class="anchor" href="#not-required-build-tools" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Not required build tools</h4>

<p>You may want to turn off build tools. To do this you need to create a .webbuild/variables.sh file in the base directory. There you can set the following variables:</p>

<table>
<thead>
<tr>
<th>Variable</th>
<th>Build tool</th>
<th>Value to turn off</th>
</tr>
</thead>
<tbody>
<tr>
<td>RUNULP</td>
<td>gulp</td>
<td>!= 1</td>
</tr>
<tr>
<td>RUNGRUNT</td>
<td>grunt</td>
<td>!= 1</td>
</tr>
<tr>
<td>RUNBOWER</td>
<td>bower</td>
<td>!= 1</td>
</tr>
<tr>
<td>RUNCOMPOSER</td>
<td>composer</td>
<td>!= 1</td>
</tr>
</tbody>
</table>

<p>Earlier versions allowed disabling by passing environment variables. Those environment variables are deprecated and will be disabled in the future.</p>

<table>
<thead>
<tr>
<th>Variable</th>
<th>Build tool</th>
</tr>
</thead>
<tbody>
<tr>
<td>NOGULP</td>
<td>gulp</td>
</tr>
<tr>
<td>NOGRUNT</td>
<td>grunt</td>
</tr>
<tr>
<td>NOBOWER</td>
<td>bower</td>
</tr>
<tr>
<td>NOCOMPOSER</td>
<td>composer</td>
</tr>
</tbody>
</table>

<p>Setting such a variable will disable installation ( except of composer which is always installed ) and execution.</p>

<p>Doing this will speed up the build process.</p>

<h2>
<a id="onbuild" class="anchor" href="#onbuild" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>ONBUILD</h2>

<p>There are two ONBUILD trigger. They copy <code>prebuild.sh</code> respectively <code>postbuild.sh</code> into the newly image. Therefore 
the following Dockerfile will allow you add standard customizations according to your needs:</p>

<pre><code>FROM briefbote/webbuild:latest
MAINTAINER Test &lt;donotreply@test.de&gt;
</code></pre>

<h2>
<a id="base-directory" class="anchor" href="#base-directory" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>BASE directory</h2>

<p>The base directory ( the directory where the entrypoint runs the build steps ) is <code>/src</code> except when
<code>/src/src</code> exists</p>

<h3>
<a id="custom-base-directory" class="anchor" href="#custom-base-directory" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom base directory</h3>

<p>If your base directory follows not the convention use the environment variable <code>SETBASEDIR</code> to change it.</p>

<h2>
<a id="build-steps" class="anchor" href="#build-steps" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Build steps</h2>

<ol>
<li>Loading <code>$BASEDIR/.webbuild/variables.sh</code> if it exists</li>
<li>
<code>nvm install 4</code> or <code>nvm install</code> in .webbuild/ is .nvmrc exists there</li>
<li>
<code>/exec/prebuild.sh</code> if it exists</li>
<li>
<code>$BASEDIR/.webbuild/prebuild.sh</code> if it exists</li>
<li>
<code>npm install</code> if <code>$BASE/package.json</code> exists</li>
<li>
<code>bower</code> if <code>$BASE/bower.json</code> exists</li>
<li>
<code>composer</code> without dev dependencies if <code>$BASE/composer.json</code> exists</li>
<li>
<code>grunt</code> if <code>$BASE/Gruntfile</code> exists</li>
<li>
<code>gulp</code> if <code>$BASE/gulpfile.js</code> exists</li>
<li>
<code>$BASE/.webbuild/custom.sh</code> if it exists, fallback <code>$BASE/custom.sh</code> (deprecated)</li>
<li>
<code>$BASEDIR/.webbuild/post4.</code>$BASEDIR/.webbuild/prebuild.sh if it exists<code>build.sh</code> if it exists</li>
<li>
<code>/exec/postbuild.sh</code> if it exists</li>
<li>Use <code>/src/build</code> as <code>/app</code> if <code>/app</code> is empty</li>
<li>Use <code>/src/release</code> as <code>/app</code> if <code>/app</code> is empty</li>
</ol>

<p>Currently a <code>$BASE/.nvmrc</code> is still respected.</p>

<h2>
<a id="return-codes" class="anchor" href="#return-codes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Return codes</h2>

<p>Non zero exit codes will be returned when one of the build steps are failing or <code>/app</code> is empty after step 10</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>Assume you want to build a web application in the current directory containing the sources within the <code>src</code> subfolder
and you want to place the build in the <code>app</code> subfolder.</p>

<p>Then you can run the build like this:</p>

<pre><code>docker run -t briefbote/webbuild:latest -v $PWD/src:/src -v $PWD/app:/app
</code></pre>

<h3>
<a id="samples" class="anchor" href="#samples" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Samples</h3>

<h4>
<a id="simple" class="anchor" href="#simple" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>simple</h4>

<p>A very simplistic sample of it is in the <code>samples/simple</code> subfolder of this repository (note that <code>test/app/</code> is in the <code>.gitignore</code> file).</p>

<p>To run the sample change to the test directory and run <code>run.sh</code>. It (re)creates the app subfolder ands starts a build
that actually does nothing more then to copy the <code>index.html</code> using a custom.sh into the <code>/app</code> folder</p>

<h2>
<a id="code" class="anchor" href="#code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Code</h2>

<p>Code is open source under the Apache 2.0 License. You can obtain it at <a href="https://github.com/sascha-andres/webbuild">https://github.com/sascha-andres/webbuild</a></p>

<p>If you want to contribute feel free to open an issue</p>

<h2>
<a id="on-hubdockercom" class="anchor" href="#on-hubdockercom" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>on hub.docker.com</h2>

<p><a href="https://hub.docker.com/r/briefbote/webbuild/">https://hub.docker.com/r/briefbote/webbuild/</a></p>

<h2>
<a id="help" class="anchor" href="#help" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Help</h2>

<p>Feel free to contact me by creating an issue on <a href="https://github.com/sascha-andres/webbuild/issues">https://github.com/sascha-andres/webbuild/issues</a>.
You can connect to me using Twitter at <a href="https://twitter.com/livingit_de">https://twitter.com/livingit_de</a>.</p>

<h2>
<a id="history" class="anchor" href="#history" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>History</h2>

<p>History is now edited on GitHub WIKI: <a href="https://github.com/sascha-andres/webbuild/wiki/History">https://github.com/sascha-andres/webbuild/wiki/History</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/sascha-andres/webbuild">Webbuild</a> is maintained by <a href="https://github.com/sascha-andres">sascha-andres</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
